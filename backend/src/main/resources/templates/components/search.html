<div xmlns:th="http://www.thymeleaf.org" th:fragment="search">
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .search-button {
      position:fixed;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border: none;
      background: none;
      cursor: pointer;
      z-index: 100;
      background-color: rgb(0, 28, 119);
      padding: 8px 16px;
      border-radius: 20px;
      transition: background-color 0.2s;
    }
    .search-button:hover {
      background-color: #444;
    }
    .overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.5);
      z-index: 200;
      justify-content: center;
      align-items: center;
    }
    .overlay.active {
      display: flex;
    }
    .popup-panel {
      background-color: white;
      border-radius: 10px;
      padding: 30px;
      width: 500px;
      max-width: 90%;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    .search-input {
      width: 100%;
      padding: 10px;
      border-radius: 20px;
      border: 1px solid #ccc;
      margin-bottom: 20px;
    }
    .button-grid {
      display: flex;
      gap: 20px;
    }
    .filter-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .filter-button {
      padding: 8px 16px;
      background-color: #dcdcdc;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .filter-button:hover {
      background-color: #bcbcbc;
    }
    .submit {
      padding: 8px 16px;
      background-color: #66ACE6;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
  </style>

  <!-- Tombol Search -->
  <form th:action="@{/search/open}" method="get" style="display:inline;">
    <button class="search-button" type="submit" title="Cari"></button>
  </form>

  <!-- Overlay dan Popup -->
  <div class="overlay" id="searchOverlay"></div>
  
    <div class="popup-panel">
      <form th:action="@{/search/result}" method="get">
        <input type="text" class="search-input" name="query" placeholder="Masukkan nama barang">
        <div class="button-grid">
          <div class="filter-column">
            <button class="filter-button" type="submit" name="sort" value="az">Huruf A-Z</button>
            <button class="filter-button" type="submit" name="sort" value="za">Huruf Z-A</button>
            <button class="filter-button" type="submit" name="sort" value="expensive">Harga Mahal</button>
            <button class="filter-button" type="submit" name="sort" value="cheap">Harga Murah</button>
            <button class="filter-button" type="submit" name="filter" value="bentuk">Bentuk</button>
          </div>
          <div class="filter-column">
            <button class="filter-button" type="submit" name="filter" value="ukuran">Ukuran</button>
            <button class="filter-button" type="submit" name="filter" value="ketebalan">Ketebalan</button>
            <button class="filter-button" type="submit" name="filter" value="material">Material</button>
            <button class="filter-button" type="submit" name="filter" value="brand">Brand</button>
          </div>
          <button type="submit" class="submit">Cari</button>
        </div>
      </form>
      <form th:action="@{/search/close}" method="post" style="margin-top:10px;">
        <button type="submit" class="filter-button">Tutup</button>
      </form>
    </div>
  </div>
</div>
<script>
    // Show overlay when search button is clicked
    document.addEventListener('DOMContentLoaded', function() {
      const searchButton = document.querySelector('.search-button');
      const overlay = document.getElementById('searchOverlay');
      const popupPanel = document.querySelector('.popup-panel');
      
      // Move popupPanel inside overlay for proper centering
      if (overlay && popupPanel && !overlay.contains(popupPanel)) {
        overlay.appendChild(popupPanel);
      }

      if (searchButton && overlay) {
        searchButton.addEventListener('click', function(e) {
          e.preventDefault();
          overlay.classList.add('active');
        });
      }

      // Close overlay when clicking outside popupPanel
      if (overlay) {
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) {
            overlay.classList.remove('active');
          }
        });
      }

      // Close overlay when "Tutup" button is clicked
      const closeBtn = popupPanel ? popupPanel.querySelector('form[action$="/search/close"] button') : null;
      if (closeBtn && overlay) {
        closeBtn.addEventListener('click', function(e) {
          e.preventDefault();
          overlay.classList.remove('active');
        });
      }
    });
  </script>
